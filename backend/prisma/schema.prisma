generator client {
  provider = "prisma-client-js"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AuditLog {
  id         String   @id @default(uuid())
  model      String
  action     String
  data       String
  before     Json?
  after      Json?
  durationMs Int?
  userId     String
  createdAt  DateTime @default(now())
  timestamp  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("audit_logs")
}

model AccountEmail {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TrustedDevice {
  id         String   @id @default(uuid())
  userId     String
  createdAt  DateTime @default(now())
  browser    String?
  deviceId   String?
  deviceName String?
  deviceType String?
  ipAddress  String?
  isRevoked  Boolean  @default(false)
  lastUsedAt DateTime @updatedAt
  os         String?
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, deviceId])
}

model User {
  id                    String           @id @default(uuid())
  email                 String           @unique
  name                  String?
  password              String?
  createdAt             DateTime         @default(now())
  avatar                String?
  googleId              String?          @unique
  updatedAt             DateTime         @updatedAt
  mfaSecret             String?
  failedAttempts        Int              @default(0)
  lastLoginAt           DateTime?
  lockedUntil           DateTime?
  mfaBackupCodes        String[]
  mfaEnabled            Boolean          @default(false)
  tokenVersion          Int              @default(0)
  provider              AuthProvider     @default(credentials)
  role                  UserRole         @default(user)
  active                Boolean          @default(true)
  createdBAP            BAP[]            @relation("BAPCreatedBy")
  approvedFundTransfers FundTransfer[]   @relation("FundTransferApprover")
  createdFundTransfers  FundTransfer[]   @relation("FundTransferCreator")
  voidedFundTransfers   FundTransfer[]   @relation("FundTransferVoider")
  receivedGoodsReceipts GoodsReceipt[]   @relation("GoodsReceiptReceivedBy")
  createdInvoices       Invoice[]        @relation("InvoiceCreatedBy")
  karyawan              Karyawan?
  loginAttempts         LoginAttempt[]
  notifications         Notification[]
  verifiedPayments      Payment[]
  rab                   RAB[]
  salesOrders           SalesOrder[]     @relation("UserSalesOrders")
  stockOpnames          StockOpname[]    @relation("OpnamePetugas")
  trustedDevices        TrustedDevice[]
  userPermissions       UserPermission[]
  sessions              UserSession[]
  auditLogs             AuditLog[]
}

model LoginAttempt {
  id        String   @id @default(uuid())
  userId    String?
  email     String
  status    String
  ipAddress String
  userAgent String?
  deviceId  String?
  reason    String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([ipAddress])
}

model UserSession {
  id           String    @id @default(uuid())
  userId       String
  sessionToken String?   @unique
  refreshToken String?   @unique
  deviceId     String?
  ipAddress    String
  userAgent    String
  country      String?
  city         String?
  isRevoked    Boolean   @default(false)
  createdAt    DateTime  @default(now())
  expiresAt    DateTime
  revokedAt    DateTime?
  fcmToken     String?
  origin       String?
  lastActiveAt DateTime?
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}

model Notification {
  id        String    @id @default(uuid())
  userId    String
  title     String    @db.VarChar(255)
  body      String
  type      String    @default("general") @db.VarChar(50)
  imageUrl  String?   @db.VarChar(500)
  actionUrl String?   @db.VarChar(500)
  data      Json?     @default("{}")
  read      Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  expiresAt DateTime?
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, read])
  @@index([createdAt])
  @@index([expiresAt])
}

model Permission {
  id              String           @id @default(uuid())
  code            String           @unique
  name            String
  module          String
  description     String?
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  rolePermissions RolePermission[]
  userPermissions UserPermission[]

  @@index([module])
  @@index([code])
}

model RolePermission {
  id           String     @id @default(uuid())
  role         UserRole
  permissionId String
  canCreate    Boolean    @default(false)
  canRead      Boolean    @default(true)
  canUpdate    Boolean    @default(false)
  canDelete    Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([role, permissionId])
  @@index([role])
}

model UserPermission {
  id           String     @id @default(uuid())
  userId       String
  permissionId String
  canCreate    Boolean    @default(false)
  canRead      Boolean    @default(true)
  canUpdate    Boolean    @default(false)
  canDelete    Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId])
  @@index([userId])
}

model Counter {
  name       String   @id
  lastNumber Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Karyawan {
  id                String              @id @default(cuid())
  nik               String              @unique
  namaLengkap       String
  tanggalLahir      DateTime?
  alamat            String?
  nomorTelepon      String?
  email             String?             @unique
  jabatan           String?
  departemen        String?
  tanggalMasuk      DateTime?
  tanggalKeluar     DateTime?
  statusKerja       String
  tipeKontrak       String?
  gajiPokok         Float?
  tunjangan         Float?
  potongan          Float?
  userId            String?             @unique
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  foto              String?
  isActive          Boolean             @default(true)
  approvedBAP       BAP[]               @relation("BAPApprovedBy")
  gaji              Gaji[]
  approvedInvoices  Invoice[]           @relation("InvoiceApprovedBy")
  user              User?               @relation(fields: [userId], references: [id])
  LedgerLine        LedgerLine[]
  PurchaseExecution PurchaseExecution[]
  purchaseOrder     PurchaseOrder[]
  purchaseRequest   PurchaseRequest[]   @relation("PRCreatedBy")
  requestedPRs      PurchaseRequest[]   @relation("PRRequestedBy")
  spk               SPK[]               @relation("SPKCreatedBy")
  spkDetail         SPKDetail[]
  spkFieldReport    SPKFieldReport[]
  balances          StaffBalance[]
  ledgerEntries     StaffLedger[]
  receivedTransfers StockTransfer[]     @relation("Receiver")
  sentTransfers     StockTransfer[]     @relation("Sender")
  teamKaryawan      TeamKaryawan[]
  uangMuka          UangMuka[]
}

model Gaji {
  id         String   @id @default(cuid())
  karyawanId String
  periode    DateTime
  gajiPokok  Float
  tunjangan  Float?
  potongan   Float?
  total      Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  karyawan   Karyawan @relation(fields: [karyawanId], references: [id])
}

model Customer {
  id            String       @id @default(uuid())
  code          String       @unique
  name          String
  email         String?      @unique
  phone         String?
  address       String?
  branch        String?
  city          String?
  province      String?
  postalCode    String?
  taxNumber     String?
  companyType   String?
  contactPerson String?
  picPhone      String?
  picEmail      String?
  notes         String?
  isActive      Boolean      @default(true)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  LedgerLine    LedgerLine[]
  projects      Project[]
  quotations    Quotation[]
  salesOrders   SalesOrder[]
}

model Project {
  id              String            @id @default(uuid())
  customerId      String
  name            String
  location        String?
  createdAt       DateTime          @default(now())
  LedgerLine      LedgerLine[]
  customer        Customer          @relation(fields: [customerId], references: [id])
  budgets         ProjectBudget[]
  expenses        ProjectExpense[]
  purchaseOrder   PurchaseOrder[]
  purchaseRequest PurchaseRequest[]
  rab             RAB[]
  spks            SPK[]
  salesOrders     SalesOrder[]
}

model Product {
  id                        String                      @id @default(uuid())
  code                      String                      @unique
  name                      String
  description               String?
  purchaseUnit              String
  storageUnit               String
  usageUnit                 String
  conversionToStorage       Decimal
  conversionToUsage         Decimal
  isConsumable              Boolean                     @default(true)
  isActive                  Boolean                     @default(true)
  image                     String?
  barcode                   String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  categoryId                String?
  type                      ProductType
  cogsAccountId             String?
  inventoryAccountId        String?
  revenueAccountId          String?
  GoodsReceiptItem          GoodsReceiptItem[]
  MaterialRequisitionItem   MaterialRequisitionItem[]
  category                  ProductCategory?            @relation(fields: [categoryId], references: [id])
  cogsAccount               ChartOfAccounts?            @relation("ProductCogs", fields: [cogsAccountId], references: [id])
  inventoryAccount          ChartOfAccounts?            @relation("ProductInventory", fields: [inventoryAccountId], references: [id])
  revenueAccount            ChartOfAccounts?            @relation("ProductRevenue", fields: [revenueAccountId], references: [id])
  PurchaseOrderLine         PurchaseOrderLine[]
  purchaseRequestDetail     PurchaseRequestDetail[]
  QuotationLines            QuotationLine[]
  rabDetail                 RABDetail[]
  rincianPertanggungJawaban RincianPertanggungjawaban[]
  salesOrderItems           SalesOrderItem[]
  stockBalances             StockBalance[]
  stockDetails              StockDetail[]
  StockOpnameItem           StockOpnameItem[]
  stockTransferItems        StockTransferItem[]
  SupplierInvoiceItem       SupplierInvoiceItem[]
}

model StockOpname {
  id            String            @id @default(uuid())
  nomorOpname   String            @unique
  tanggalOpname DateTime          @default(now())
  type          OpnameType        @default(PERIODIC)
  status        OpnameStatus      @default(DRAFT)
  keterangan    String?
  petugasId     String
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  warehouseId   String
  petugas       User              @relation("OpnamePetugas", fields: [petugasId], references: [id])
  warehouse     Warehouse         @relation(fields: [warehouseId], references: [id])
  items         StockOpnameItem[]
}

model StockOpnameItem {
  id            String      @id @default(uuid())
  stockOpnameId String
  productId     String
  stokSistem    Decimal     @default(0) @db.Decimal(18, 4)
  stokFisik     Decimal     @db.Decimal(18, 4)
  selisih       Decimal     @db.Decimal(18, 4)
  hargaSatuan   Decimal     @db.Decimal(19, 2)
  totalNilai    Decimal     @db.Decimal(19, 2)
  catatanItem   String?
  createdAt     DateTime    @default(now())
  product       Product     @relation(fields: [productId], references: [id])
  stockOpname   StockOpname @relation(fields: [stockOpnameId], references: [id], onDelete: Cascade)
}

model Warehouse {
  id                   String                @id @default(uuid())
  code                 String                @unique
  name                 String
  address              String?
  isMain               Boolean               @default(false)
  isActive             Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  isWip                Boolean               @default(false)
  inventoryAccountId   String?
  goodsReceipts        GoodsReceipt[]
  materialRequisitions MaterialRequisition[]
  PurchaseOrder        PurchaseOrder[]
  stockBalances        StockBalance[]
  stockDetails         StockDetail[]
  stockOpnames         StockOpname[]
  transfersFrom        StockTransfer[]       @relation("FromWarehouse")
  transfersTo          StockTransfer[]       @relation("ToWarehouse")
  inventoryAccount     ChartOfAccounts?      @relation("WarehouseInventory", fields: [inventoryAccountId], references: [id])
}

model StockBalance {
  id             String    @id @default(uuid())
  productId      String
  period         DateTime
  stockAwal      Decimal   @default(0) @db.Decimal(18, 4)
  stockIn        Decimal   @default(0) @db.Decimal(18, 4)
  stockOut       Decimal   @default(0) @db.Decimal(18, 4)
  justIn         Decimal   @default(0) @db.Decimal(18, 4)
  justOut        Decimal   @default(0) @db.Decimal(18, 4)
  onPR           Decimal   @default(0) @db.Decimal(18, 4)
  bookedStock    Decimal   @default(0) @db.Decimal(18, 4)
  stockAkhir     Decimal   @default(0) @db.Decimal(18, 4)
  availableStock Decimal   @default(0) @db.Decimal(18, 4)
  inventoryValue Decimal   @default(0) @db.Decimal(18, 2)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  warehouseId    String
  product        Product   @relation(fields: [productId], references: [id])
  warehouse      Warehouse @relation(fields: [warehouseId], references: [id])

  @@unique([productId, warehouseId, period])
}

model StockDetail {
  id                        String                   @id @default(uuid())
  productId                 String
  stockAwalSnapshot         Decimal                  @db.Decimal(18, 4)
  stockAkhirSnapshot        Decimal                  @db.Decimal(18, 4)
  transQty                  Decimal                  @db.Decimal(18, 4)
  transUnit                 String
  baseQty                   Decimal                  @db.Decimal(18, 4)
  residualQty               Decimal                  @default(0) @db.Decimal(18, 4)
  isFullyConsumed           Boolean                  @default(false)
  type                      TransactionType
  source                    SourceType
  pricePerUnit              Decimal                  @db.Decimal(18, 2)
  referenceNo               String?
  notes                     String?
  originalTransactionId     String?
  createdAt                 DateTime                 @default(now())
  materialRequisitionItemId String?
  warehouseId               String
  GoodsReceiptItem          GoodsReceiptItem?
  StockAllocation           StockAllocation[]
  MaterialRequisitionItem   MaterialRequisitionItem? @relation(fields: [materialRequisitionItemId], references: [id])
  originalTransaction       StockDetail?             @relation("ReturnReference", fields: [originalTransactionId], references: [id])
  returns                   StockDetail[]            @relation("ReturnReference")
  product                   Product                  @relation(fields: [productId], references: [id])
  warehouse                 Warehouse                @relation(fields: [warehouseId], references: [id])
}

model StockTransfer {
  id              String              @id @default(uuid())
  transferNumber  String              @unique
  transferDate    DateTime            @default(now())
  status          TransferStatus      @default(DRAFT)
  notes           String?
  fromWarehouseId String
  toWarehouseId   String
  senderId        String
  receiverId      String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  fromWarehouse   Warehouse           @relation("FromWarehouse", fields: [fromWarehouseId], references: [id])
  receiver        Karyawan?           @relation("Receiver", fields: [receiverId], references: [id])
  sender          Karyawan            @relation("Sender", fields: [senderId], references: [id])
  toWarehouse     Warehouse           @relation("ToWarehouse", fields: [toWarehouseId], references: [id])
  items           StockTransferItem[]
}

model StockTransferItem {
  id         String        @id @default(uuid())
  transferId String
  productId  String
  quantity   Decimal       @db.Decimal(18, 4)
  unit       String
  cogs       Decimal       @default(0) @db.Decimal(18, 2)
  product    Product       @relation(fields: [productId], references: [id])
  transfer   StockTransfer @relation(fields: [transferId], references: [id], onDelete: Cascade)
}

model GoodsReceipt {
  id                 String             @id @default(uuid())
  grNumber           String             @unique
  receivedDate       DateTime?
  vendorDeliveryNote String
  vehicleNumber      String?
  driverName         String?
  purchaseOrderId    String?
  receivedById       String
  status             DocumentStatus     @default(COMPLETED)
  notes              String?
  warehouseId        String?
  createdAt          DateTime           @default(now())
  expectedDate       DateTime?
  sourceType         SourceType         @default(PO)
  PurchaseOrder      PurchaseOrder?     @relation(fields: [purchaseOrderId], references: [id])
  receivedBy         User               @relation("GoodsReceiptReceivedBy", fields: [receivedById], references: [id])
  Warehouse          Warehouse?         @relation(fields: [warehouseId], references: [id])
  items              GoodsReceiptItem[]
}

model GoodsReceiptItem {
  id                      String                 @id @default(uuid())
  goodsReceiptId          String
  productId               String
  qtyReceived             Decimal                @db.Decimal(18, 4)
  unit                    String
  stockDetailId           String?                @unique
  purchaseRequestDetailId String?
  purchaseOrderLineId     String?
  qcNotes                 String?
  qcStatus                QCStatus               @default(PENDING)
  qtyPassed               Decimal                @db.Decimal(18, 4)
  qtyPlanReceived         Decimal                @default(0) @db.Decimal(18, 4)
  qtyRejected             Decimal                @default(0) @db.Decimal(18, 4)
  status                  ItemStatus             @default(RECEIVED)
  unitPrice               Decimal                @default(0) @db.Decimal(18, 2)
  goodsReceipt            GoodsReceipt           @relation(fields: [goodsReceiptId], references: [id])
  product                 Product                @relation(fields: [productId], references: [id])
  purchaseOrderLine       PurchaseOrderLine?     @relation(fields: [purchaseOrderLineId], references: [id])
  purchaseRequestDetail   PurchaseRequestDetail? @relation(fields: [purchaseRequestDetailId], references: [id])
  stockDetail             StockDetail?           @relation(fields: [stockDetailId], references: [id])
}

model MaterialRequisition {
  id              String                    @id @default(uuid())
  mrNumber        String                    @unique
  issuedDate      DateTime                  @default(now())
  projectId       String?
  requestedById   String
  status          MRStatus                  @default(PENDING)
  notes           String?
  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt
  warehouseId     String?
  issuedById      String?
  preparedById    String?
  purchaseOrderId String?
  qrToken         String                    @unique @default(cuid())
  sourceType      SourceType                @default(PO)
  PurchaseOrder   PurchaseOrder?            @relation(fields: [purchaseOrderId], references: [id])
  Warehouse       Warehouse?                @relation(fields: [warehouseId], references: [id])
  items           MaterialRequisitionItem[]
}

model MaterialRequisitionItem {
  id                      String                 @id @default(uuid())
  materialRequisitionId   String
  purchaseRequestDetailId String?
  productId               String
  qtyIssued               Decimal                @db.Decimal(18, 4)
  unit                    String
  priceUnit               Decimal                @default(0) @db.Decimal(18, 2)
  qtyRequested            Decimal                @db.Decimal(18, 4)
  materialRequisition     MaterialRequisition    @relation(fields: [materialRequisitionId], references: [id], onDelete: Cascade)
  product                 Product                @relation(fields: [productId], references: [id])
  purchaseRequestDetail   PurchaseRequestDetail? @relation(fields: [purchaseRequestDetailId], references: [id])
  stockAllocations        StockAllocation[]
  StockDetail             StockDetail[]
}

model StockAllocation {
  id            String                  @id @default(uuid())
  mrItemId      String
  stockDetailId String
  qtyTaken      Decimal                 @db.Decimal(18, 4)
  mrItem        MaterialRequisitionItem @relation(fields: [mrItemId], references: [id])
  stockDetail   StockDetail             @relation(fields: [stockDetailId], references: [id])
}

model RAB {
  id          String      @id @default(uuid())
  projectId   String
  name        String
  description String?
  total       Decimal     @default(0)
  status      RABStatus   @default(DRAFT)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  createdById String?
  createdBy   User?       @relation(fields: [createdById], references: [id])
  project     Project     @relation(fields: [projectId], references: [id])
  rabDetails  RABDetail[]
}

model RABDetail {
  id          String      @id @default(uuid())
  rabId       String
  productId   String?
  description String
  qty         Decimal
  unit        String
  price       Decimal
  subtotal    Decimal
  costType    CostType    @default(MATERIAL)
  notes       String?
  categoryRab CategoryRAB @default(STRUCTURE)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  product     Product?    @relation(fields: [productId], references: [id])
  rab         RAB         @relation(fields: [rabId], references: [id], onDelete: Cascade)

  @@index([rabId])
  @@index([categoryRab])
  @@index([costType])
}

model ProductCategory {
  id       String    @id @default(uuid())
  name     String    @unique
  products Product[]
}

model Quotation {
  id              String                @id @default(uuid())
  quotationNumber String                @unique
  version         Int                   @default(1)
  customerId      String
  currency        String                @default("IDR")
  exchangeRate    Decimal               @default(1.0)
  status          QuotationStatus       @default(DRAFT)
  validFrom       DateTime?
  validUntil      DateTime?
  paymentTermId   String?
  subtotal        Decimal               @default(0)
  discountType    DiscountType          @default(PERCENT)
  discountValue   Decimal               @default(0)
  taxInclusive    Boolean               @default(false)
  taxTotal        Decimal               @default(0)
  otherCharges    Decimal               @default(0)
  total           Decimal               @default(0)
  notes           String?
  preparedBy      String?
  approvedBy      String?
  approvedAt      DateTime?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  salesOrderId    String?
  quotationDate   DateTime              @default(now())
  customer        Customer              @relation(fields: [customerId], references: [id])
  paymentTerm     PaymentTerm?          @relation(fields: [paymentTermId], references: [id])
  salesOrder      SalesOrder?           @relation(fields: [salesOrderId], references: [id])
  approvals       QuotationApproval[]
  attachments     QuotationAttachment[]
  comments        QuotationComment[]
  histories       QuotationHistory[]
  lines           QuotationLine[]
}

model QuotationLine {
  id                String       @id @default(uuid())
  quotationId       String
  lineNo            Int
  lineType          LineType     @default(PRODUCT)
  productId         String?
  description       String?
  qty               Decimal      @default(1)
  uom               String?
  unitPrice         Decimal      @default(0)
  lineDiscountType  DiscountType @default(PERCENT)
  lineDiscountValue Decimal      @default(0)
  lineSubtotal      Decimal      @default(0)
  taxId             String?
  taxAmount         Decimal      @default(0)
  lineTotal         Decimal      @default(0)
  createdAt         DateTime     @default(now())
  product           Product?     @relation(fields: [productId], references: [id])
  quotation         Quotation    @relation(fields: [quotationId], references: [id])
  tax               Tax?         @relation(fields: [taxId], references: [id])
}

model QuotationHistory {
  id          String    @id @default(uuid())
  quotationId String
  version     Int
  changedBy   String?
  changeAt    DateTime  @default(now())
  changeNote  String?
  payload     Json
  quotation   Quotation @relation(fields: [quotationId], references: [id])
}

model QuotationApproval {
  id          String          @id @default(uuid())
  quotationId String
  approverId  String?
  sequence    Int             @default(1)
  status      QuotationStatus @default(REVIEW)
  notes       String?
  actedAt     DateTime?
  quotation   Quotation       @relation(fields: [quotationId], references: [id])
}

model QuotationAttachment {
  id          String    @id @default(uuid())
  quotationId String
  fileName    String
  filePath    String
  fileSize    Int?
  uploadedBy  String?
  uploadedAt  DateTime  @default(now())
  quotation   Quotation @relation(fields: [quotationId], references: [id])
}

model QuotationComment {
  id          String    @id @default(uuid())
  quotationId String
  commentedBy String?
  comment     String
  createdAt   DateTime  @default(now())
  quotation   Quotation @relation(fields: [quotationId], references: [id])
}

model Tax {
  id             String          @id @default(uuid())
  code           String          @unique
  name           String
  description    String?
  rate           Decimal
  isInclusive    Boolean         @default(false)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  quotationItems QuotationLine[]
}

model PaymentTerm {
  id          String      @id @default(uuid())
  code        String      @unique
  name        String
  description String?
  dueDays     Int
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  quotations  Quotation[]
}

model SalesOrder {
  id             String               @id @default(uuid())
  soNumber       String               @unique
  soDate         DateTime
  customerId     String
  projectId      String
  userId         String
  createdAt      DateTime             @default(now())
  currency       String               @default("IDR")
  discountTotal  Decimal              @default(0) @db.Decimal(18, 2)
  grandTotal     Decimal              @default(0) @db.Decimal(18, 2)
  notes          String?
  status         OrderStatus          @default(DRAFT)
  subtotal       Decimal              @default(0) @db.Decimal(18, 2)
  taxTotal       Decimal              @default(0) @db.Decimal(18, 2)
  updatedAt      DateTime             @updatedAt
  type           OrderType
  isTaxInclusive Boolean              @default(false)
  bap            BAP[]
  invoices       Invoice[]
  LedgerLine     LedgerLine[]
  quotation      Quotation[]
  spk            SPK[]
  customer       Customer             @relation(fields: [customerId], references: [id])
  project        Project              @relation(fields: [projectId], references: [id])
  user           User                 @relation("UserSalesOrders", fields: [userId], references: [id])
  documents      SalesOrderDocument[]
  items          SalesOrderItem[]
  uangMuka       UangMuka[]

  @@index([customerId, soDate])
  @@index([status])
  @@index([projectId])
}

model SalesOrderItem {
  id           String           @id @default(uuid())
  salesOrderId String
  productId    String?
  description  String?
  qty          Decimal          @db.Decimal(18, 4)
  unitPrice    Decimal          @db.Decimal(18, 2)
  discount     Decimal          @default(0) @db.Decimal(18, 2)
  itemType     ItemType         @default(PRODUCT)
  lineTotal    Decimal          @default(0) @db.Decimal(18, 2)
  name         String
  taxRate      Decimal          @default(0) @db.Decimal(5, 2)
  lineNo       Int
  uom          String?
  spkDetail    SPKDetail[]
  fieldReports SPKFieldReport[] @relation("SPKDetailToFieldReport")
  product      Product?         @relation(fields: [productId], references: [id], onDelete: Restrict)
  salesOrder   SalesOrder       @relation(fields: [salesOrderId], references: [id], onDelete: Cascade)

  @@index([salesOrderId])
  @@index([productId])
}

model SalesOrderDocument {
  id           String     @id @default(uuid())
  salesOrderId String
  createdAt    DateTime   @default(now())
  docDate      DateTime?
  docNumber    String?
  docType      DocType
  fileUrl      String?
  meta         Json?
  salesOrder   SalesOrder @relation(fields: [salesOrderId], references: [id], onDelete: Cascade)

  @@index([salesOrderId, docType])
}

model TeamKaryawan {
  id         String   @id @default(cuid())
  teamId     String
  karyawanId String
  karyawan   Karyawan @relation(fields: [karyawanId], references: [id])
  team       Team     @relation(fields: [teamId], references: [id])
}

model Team {
  id            String          @id @default(cuid())
  namaTeam      String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  deskripsi     String?
  purchaseOrder PurchaseOrder[]
  spk           SPK[]
  karyawan      TeamKaryawan[]
}

model SPK {
  id              String            @id @default(uuid())
  spkNumber       String            @unique
  spkDate         DateTime          @default(now())
  createdById     String
  salesOrderId    String
  teamId          String?
  notes           String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  progress        Int?              @default(0)
  spkStatus       Boolean           @default(false)
  spkStatusClose  Boolean           @default(false)
  projectId       String?
  budget          ProjectBudget[]
  expense         ProjectExpense[]
  purchaseOrder   PurchaseOrder[]
  purchaseRequest PurchaseRequest[]
  createdBy       Karyawan          @relation("SPKCreatedBy", fields: [createdById], references: [id])
  project         Project?          @relation(fields: [projectId], references: [id])
  salesOrder      SalesOrder        @relation(fields: [salesOrderId], references: [id])
  team            Team?             @relation(fields: [teamId], references: [id])
  details         SPKDetail[]
  spkFieldReport  SPKFieldReport[]
  uangMuka        UangMuka[]
}

model SPKDetail {
  id               String          @id @default(uuid())
  spkId            String
  karyawanId       String?
  salesOrderItemId String?
  lokasiUnit       String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  karyawan         Karyawan?       @relation(fields: [karyawanId], references: [id])
  salesOrderItem   SalesOrderItem? @relation(fields: [salesOrderItemId], references: [id], onDelete: Restrict)
  spk              SPK             @relation(fields: [spkId], references: [id], onDelete: Cascade)
}

model SPKFieldReport {
  id         String                @id @default(uuid())
  spkId      String
  karyawanId String
  type       ReportType            @default(PROGRESS)
  note       String?
  reportedAt DateTime              @default(now())
  status     ReportStatus          @default(PENDING)
  createdAt  DateTime              @default(now())
  updatedAt  DateTime              @updatedAt
  progress   Int?                  @default(0)
  soDetailId String?
  karyawan   Karyawan              @relation(fields: [karyawanId], references: [id])
  soDetail   SalesOrderItem?       @relation("SPKDetailToFieldReport", fields: [soDetailId], references: [id], onDelete: Restrict)
  spk        SPK                   @relation(fields: [spkId], references: [id], onDelete: Cascade)
  photos     SPKFieldReportPhoto[]
}

model SPKFieldReportPhoto {
  id         String         @id @default(uuid())
  reportId   String
  imageUrl   String
  caption    String?
  uploadedBy String
  uploadedAt DateTime       @default(now())
  latitude   Float?
  longitude  Float?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  report     SPKFieldReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
}

model BAP {
  id              String     @id @default(uuid())
  bapNumber       String     @unique
  bapDate         DateTime
  salesOrderId    String
  projectId       String
  userId          String
  workDescription String?
  location        String?
  status          BAPStatus  @default(DRAFT)
  isApproved      Boolean    @default(false)
  approvedAt      DateTime?
  notes           String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  createdById     String
  createdBy       User       @relation("BAPCreatedBy", fields: [createdById], references: [id])
  salesOrder      SalesOrder @relation(fields: [salesOrderId], references: [id])
  user            Karyawan   @relation("BAPApprovedBy", fields: [userId], references: [id])
  photos          BAPPhoto[]

  @@index([salesOrderId])
  @@index([bapNumber])
  @@index([status])
}

model BAPPhoto {
  id        String        @id @default(uuid())
  bapId     String
  photoUrl  String
  caption   String?
  createdAt DateTime      @default(now())
  category  PhotoCategory
  source    String?
  bap       BAP           @relation(fields: [bapId], references: [id], onDelete: Cascade)

  @@index([bapId])
  @@index([category])
}

model BankAccount {
  id            String           @id @default(uuid())
  bankName      String
  accountNumber String           @unique
  accountHolder String
  branch        String?
  isActive      Boolean          @default(true)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  accountCOAId  String?
  accountCOA    ChartOfAccounts? @relation(fields: [accountCOAId], references: [id], onDelete: Cascade)
  invoice       Invoice[]
  payment       Payment[]
}

model Invoice {
  id              String         @id @default(uuid())
  invoiceNumber   String         @unique
  invoiceDate     DateTime
  salesOrderId    String?
  currency        String         @default("IDR")
  subtotal        Decimal        @default(0) @db.Decimal(18, 2)
  discountTotal   Decimal        @default(0) @db.Decimal(18, 2)
  taxTotal        Decimal        @default(0) @db.Decimal(18, 2)
  grandTotal      Decimal        @default(0) @db.Decimal(18, 2)
  notes           String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  approvalStatus  ApprovalStatus @default(PENDING)
  approvedAt      DateTime?
  approvedById    String?
  balanceDue      Decimal        @default(0) @db.Decimal(18, 2)
  createdById     String
  dueDate         DateTime
  exchangeRate    Decimal        @default(1) @db.Decimal(18, 6)
  installmentType String         @default("FULL")
  internalNotes   String?
  paidTotal       Decimal        @default(0) @db.Decimal(18, 2)
  paymentTerm     String?
  rejectedById    String?
  rejectedReason  String?
  termsConditions String?
  totalAmount     Decimal        @default(0) @db.Decimal(18, 2)
  status          InvoiceStatus  @default(WAITING_APPROVAL)
  bankAccountId   String?
  installments    Installment[]
  approvedBy      Karyawan?      @relation("InvoiceApprovedBy", fields: [approvedById], references: [id])
  bankAccount     BankAccount?   @relation(fields: [bankAccountId], references: [id])
  createdBy       User           @relation("InvoiceCreatedBy", fields: [createdById], references: [id])
  salesOrder      SalesOrder?    @relation(fields: [salesOrderId], references: [id])
  items           InvoiceItem[]
  invoiceTax      InvoiceTax[]
  payments        Payment[]

  @@index([salesOrderId])
  @@index([createdById])
  @@index([status])
  @@index([dueDate])
  @@index([invoiceDate])
}

model InvoiceItem {
  id              String  @id @default(uuid())
  invoiceId       String
  soItemId        String?
  name            String
  description     String?
  uom             String?
  qty             Decimal @db.Decimal(18, 4)
  unitPrice       Decimal @db.Decimal(18, 2)
  discount        Decimal @default(0) @db.Decimal(18, 2)
  taxRate         Decimal @default(0) @db.Decimal(5, 2)
  lineTotal       Decimal @default(0) @db.Decimal(18, 2)
  discountPercent Decimal @default(0) @db.Decimal(5, 2)
  itemCode        String?
  netAmount       Decimal @default(0) @db.Decimal(18, 2)
  taxAmount       Decimal @default(0) @db.Decimal(18, 2)
  taxCode         String?
  taxable         Boolean @default(true)
  invoice         Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([itemCode])
}

model Payment {
  id            String        @id @default(uuid())
  invoiceId     String
  payDate       DateTime
  amount        Decimal       @db.Decimal(18, 2)
  reference     String?
  notes         String?
  createdAt     DateTime      @default(now())
  attachment    String?
  currency      String        @default("IDR")
  exchangeRate  Decimal       @default(1) @db.Decimal(18, 6)
  installmentId String?
  status        PaymentStatus @default(PENDING)
  updatedAt     DateTime      @updatedAt
  verified      Boolean       @default(false)
  verifiedAt    DateTime?
  verifiedById  String?
  method        PaymentMethod
  bankAccountId String?
  bankAccount   BankAccount?  @relation(fields: [bankAccountId], references: [id])
  installment   Installment?  @relation(fields: [installmentId], references: [id])
  invoice       Invoice       @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  verifiedBy    User?         @relation(fields: [verifiedById], references: [id])

  @@index([invoiceId, payDate])
  @@index([status])
  @@index([reference])
}

model Installment {
  id                String            @id @default(uuid())
  invoiceId         String
  installmentNumber Int
  name              String
  amount            Decimal           @db.Decimal(18, 2)
  percentage        Decimal?          @db.Decimal(5, 2)
  dueDate           DateTime
  status            InstallmentStatus @default(PENDING)
  paidAmount        Decimal           @default(0) @db.Decimal(18, 2)
  balance           Decimal           @default(0) @db.Decimal(18, 2)
  description       String?
  conditions        String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  paidAt            DateTime?
  invoice           Invoice           @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  payments          Payment[]

  @@index([invoiceId])
  @@index([dueDate])
  @@index([status])
}

model InvoiceTax {
  id            String  @id @default(uuid())
  invoiceId     String
  taxCode       String
  taxRate       Decimal @db.Decimal(5, 2)
  taxableAmount Decimal @db.Decimal(18, 2)
  taxAmount     Decimal @db.Decimal(18, 2)
  invoice       Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([taxCode])
}

model PurchaseRequest {
  id                 String                  @id @default(uuid())
  nomorPr            String                  @unique
  tanggalPr          DateTime                @default(now())
  keterangan         String?
  status             PurchaseRequestStatus   @default(DRAFT)
  projectId          String?
  karyawanId         String
  spkId              String?
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  requestedById      String?
  accountPencairanId String?
  parentPrId         String?
  sisaBudget         Decimal                 @default(0) @db.Decimal(19, 2)
  purchaseOrders     PurchaseOrder[]
  accountPencairan   ChartOfAccounts?        @relation(fields: [accountPencairanId], references: [id])
  karyawan           Karyawan                @relation("PRCreatedBy", fields: [karyawanId], references: [id])
  parentPr           PurchaseRequest?        @relation("PRParentChild", fields: [parentPrId], references: [id], onDelete: Restrict)
  childPrs           PurchaseRequest[]       @relation("PRParentChild")
  project            Project?                @relation(fields: [projectId], references: [id], onDelete: Cascade)
  requestedBy        Karyawan?               @relation("PRRequestedBy", fields: [requestedById], references: [id])
  spk                SPK?                    @relation(fields: [spkId], references: [id])
  details            PurchaseRequestDetail[]
  staffLedgers       StaffLedger[]
  uangMuka           UangMuka[]
}

model PurchaseRequestDetail {
  id                        String                      @id @default(uuid())
  purchaseRequestId         String
  productId                 String
  projectBudgetId           String?
  jumlah                    Decimal                     @db.Decimal(10, 2)
  satuan                    String
  estimasiHargaSatuan       Decimal                     @db.Decimal(19, 2)
  estimasiTotalHarga        Decimal                     @db.Decimal(19, 2)
  catatanItem               String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  sourceProduct             SourceProductType?
  jumlahDipesan             Decimal?                    @default(0) @db.Decimal(18, 4)
  jumlahTerpenuhi           Decimal?                    @default(0) @db.Decimal(18, 4)
  stokTersediaSaatIni       Decimal?                    @default(0) @db.Decimal(18, 4)
  warehouseAllocation       Json?
  goodsReceiptItems         GoodsReceiptItem[]
  MaterialRequisitionItem   MaterialRequisitionItem[]
  PurchaseOrderLine         PurchaseOrderLine[]
  product                   Product                     @relation(fields: [productId], references: [id])
  projectBudget             ProjectBudget?              @relation(fields: [projectBudgetId], references: [id])
  purchaseRequest           PurchaseRequest             @relation(fields: [purchaseRequestId], references: [id], onDelete: Cascade)
  rincianPertanggungjawaban RincianPertanggungjawaban[]
}

model UangMuka {
  id                  String               @id @default(uuid())
  nomor               String               @unique
  tanggalPengajuan    DateTime             @default(now())
  tanggalPencairan    DateTime?
  jumlah              Decimal              @db.Decimal(19, 2)
  keterangan          String?
  status              UangMukaStatus       @default(PENDING)
  purchaseRequestId   String?
  karyawanId          String
  spkId               String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  buktiPencairanUrl   String?
  metodePencairan     MetodePembayaran?
  namaBankTujuan      String?
  namaEwalletTujuan   String?
  nomorRekeningTujuan String?
  accountPencairanId  String?
  salesOrderId        String?
  pertanggungjawaban  Pertanggungjawaban[]
  accountPencairan    ChartOfAccounts?     @relation(fields: [accountPencairanId], references: [id])
  karyawan            Karyawan             @relation(fields: [karyawanId], references: [id])
  purchaseRequest     PurchaseRequest?     @relation(fields: [purchaseRequestId], references: [id])
  salesOrder          SalesOrder?          @relation(fields: [salesOrderId], references: [id])
  spk                 SPK?                 @relation(fields: [spkId], references: [id])
}

model Pertanggungjawaban {
  id                   String                      @id @default(uuid())
  nomor                String                      @unique
  tanggal              DateTime                    @default(now())
  totalBiaya           Decimal                     @db.Decimal(19, 2)
  sisaUangDikembalikan Decimal                     @db.Decimal(19, 2)
  keterangan           String?
  uangMukaId           String
  createdAt            DateTime                    @default(now())
  updatedAt            DateTime                    @updatedAt
  status               StatusRincianPj             @default(PENDING)
  uangMuka             UangMuka                    @relation(fields: [uangMukaId], references: [id])
  details              RincianPertanggungjawaban[]
}

model RincianPertanggungjawaban {
  id                      String                        @id @default(uuid())
  pertanggungjawabanId    String
  tanggalTransaksi        DateTime
  keterangan              String
  jumlah                  Decimal                       @db.Decimal(19, 2)
  nomorBukti              String?
  purchaseRequestDetailId String?
  productId               String
  createdAt               DateTime                      @default(now())
  updatedAt               DateTime                      @updatedAt
  jenisPembayaran         JenisPembayaran               @default(CASH)
  fotoBukti               FotoBuktiPertanggungjawaban[]
  pertanggungjawaban      Pertanggungjawaban            @relation(fields: [pertanggungjawabanId], references: [id], onDelete: Cascade)
  product                 Product                       @relation(fields: [productId], references: [id])
  purchaseRequestDetail   PurchaseRequestDetail?        @relation(fields: [purchaseRequestDetailId], references: [id])
}

model FotoBuktiPertanggungjawaban {
  id          String                    @id @default(uuid())
  rincianPjId String
  url         String
  keterangan  String?
  createdAt   DateTime                  @default(now())
  rincianPj   RincianPertanggungjawaban @relation(fields: [rincianPjId], references: [id], onDelete: Cascade)
}

model ProjectBudget {
  id          String                  @id @default(uuid())
  description String
  amount      Decimal                 @db.Decimal(18, 2)
  issueDate   DateTime
  projectId   String
  spkId       String?
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt
  status      BudgetStatus            @default(DRAFT)
  project     Project                 @relation(fields: [projectId], references: [id], onDelete: Cascade)
  spk         SPK?                    @relation(fields: [spkId], references: [id])
  prDetails   PurchaseRequestDetail[]

  @@index([projectId])
}

model ProjectExpense {
  id                String          @id @default(uuid())
  expenseDate       DateTime
  description       String
  amount            Decimal         @db.Decimal(18, 2)
  receiptUrl        String?
  projectId         String
  spkId             String?
  paidFromAccountId String
  expenseAccountId  String
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  journalEntryId    String?         @unique
  status            ExpenseStatus   @default(DRAFT)
  supplierId        String?
  expenseAccount    ChartOfAccounts @relation("ExpenseCOA", fields: [expenseAccountId], references: [id])
  journalEntry      JournalEntry?   @relation(fields: [journalEntryId], references: [id])
  paidFromAccount   ChartOfAccounts @relation("PaidFromCOA", fields: [paidFromAccountId], references: [id])
  project           Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  spk               SPK?            @relation(fields: [spkId], references: [id])
  supplier          Supplier?       @relation(fields: [supplierId], references: [id])

  @@index([projectId])
  @@index([expenseDate])
  @@index([spkId])
}

model TaxRate {
  id          String            @id @default(uuid())
  name        String            @unique
  rate        Decimal
  isActive    Boolean           @default(true)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  coaAccounts ChartOfAccounts[]
  LedgerLine  LedgerLine[]
}

model ChartOfAccounts {
  id                   String                 @id @default(uuid())
  code                 String                 @unique
  name                 String
  description          String?
  type                 CoaType
  normalBalance        CoaNormalBalance
  postingType          CoaPostingType         @default(POSTING)
  cashflowType         CoaCashflowType        @default(NONE)
  status               CoaStatus              @default(ACTIVE)
  isReconcilable       Boolean                @default(false)
  defaultCurrency      String                 @default("IDR")
  parentId             String?
  taxRateId            String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  bankAccount          BankAccount[]
  parent               ChartOfAccounts?       @relation("CoaHierarchy", fields: [parentId], references: [id])
  children             ChartOfAccounts[]      @relation("CoaHierarchy")
  taxRate              TaxRate?               @relation(fields: [taxRateId], references: [id])
  fundTransferFee      FundTransfer[]         @relation("FundTransferFee")
  fundTransferSource   FundTransfer[]         @relation("FundTransferSource")
  fundTransferDest     FundTransfer[]         @relation("FundTransferDestination")
  GeneralLedgerSummary GeneralLedgerSummary[]
  journalLines         JournalEntryLine[]
  LedgerLine           LedgerLine[]
  openingBalanceDetail OpeningBalanceDetail[]
  paymentVoucher       PaymentVoucher[]
  productsAsCogs       Product[]              @relation("ProductCogs")
  productsAsInventory  Product[]              @relation("ProductInventory")
  productsAsRevenue    Product[]              @relation("ProductRevenue")
  expenseAccount       ProjectExpense[]       @relation("ExpenseCOA")
  paidFromAccount      ProjectExpense[]       @relation("PaidFromCOA")
  purchaseRequests     PurchaseRequest[]
  Reconciliation       Reconciliation[]
  systemAccounts       SystemAccount[]
  TrialBalance         TrialBalance[]
  uangMuka             UangMuka[]
  warehouses           Warehouse[]            @relation("WarehouseInventory")

  assetCategoriesAsAsset   AssetCategory[] @relation("AssetAccount")
  assetCategoriesAsAccum   AssetCategory[] @relation("AccumDeprecAccount")
  assetCategoriesAsExpense AssetCategory[] @relation("DeprecExpenseAccount")
}

model JournalEntry {
  id               String             @id @default(uuid())
  transactionDate  DateTime
  description      String
  sourceDocument   String?
  sourceDocumentId String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  lines            JournalEntryLine[]
  Ledger           Ledger[]
  paymentVoucher   PaymentVoucher?
  projectExpense   ProjectExpense?
  sipplierInvoice  SupplierInvoice?
  supplierInvoice  Supplier[]         @relation("JournalEntryToSupplier")

  @@index([transactionDate])
  @@index([sourceDocument, sourceDocumentId])
}

model JournalEntryLine {
  id             String          @id @default(uuid())
  journalEntryId String
  coaId          String
  debit          Decimal         @default(0) @db.Decimal(18, 2)
  credit         Decimal         @default(0) @db.Decimal(18, 2)
  description    String?
  account        ChartOfAccounts @relation(fields: [coaId], references: [id])
  parent         JournalEntry    @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)

  @@index([journalEntryId])
  @@index([coaId])
}

model Supplier {
  id                 String                @id @default(uuid())
  code               String                @unique
  name               String
  status             SupplierStatus        @default(ACTIVE)
  email              String?               @unique
  phone              String?
  website            String?
  billingAddress     String?
  shippingAddress    String?
  npwp               String?               @unique
  isTaxable          Boolean               @default(false)
  termOfPaymentId    String?
  supplierCategoryId String?
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  onWip              Boolean               @default(false)
  LedgerLine         LedgerLine[]
  payments           PaymentVoucher[]
  projectExpenses    ProjectExpense[]
  purchaseOrders     PurchaseOrder[]
  supplierCategory   SupplierCategory?     @relation(fields: [supplierCategoryId], references: [id])
  termOfPayment      TermOfPayment?        @relation(fields: [termOfPaymentId], references: [id])
  bankAccounts       SupplierBankAccount[]
  contacts           SupplierContact[]
  supplierInvoices   SupplierInvoice[]
  journalEntry       JournalEntry[]        @relation("JournalEntryToSupplier")
  assetMaintenances  AssetMaintenance[]

  @@index([name])
  @@index([status])
}

model SupplierContact {
  id         String   @id @default(uuid())
  name       String
  position   String?
  email      String?
  phone      String?
  isPrimary  Boolean  @default(false)
  supplierId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  supplier   Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  @@index([supplierId])
}

model SupplierBankAccount {
  id                String   @id @default(uuid())
  bankName          String
  accountHolderName String
  accountNumber     String
  branch            String?
  isPrimary         Boolean  @default(false)
  supplierId        String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  supplier          Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  @@index([supplierId])
}

model SupplierCategory {
  id          String     @id @default(uuid())
  name        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  suppliers   Supplier[]
}

model TermOfPayment {
  id          String     @id @default(uuid())
  name        String     @unique
  days        Int        @default(0)
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  suppliers   Supplier[]
}

model PurchaseOrder {
  id                   String                   @id @default(uuid())
  poNumber             String                   @unique
  orderDate            DateTime
  expectedDeliveryDate DateTime?
  status               PurchaseOrderStatus      @default(DRAFT)
  supplierId           String
  projectId            String?
  orderedById          String
  subtotal             Decimal                  @default(0) @db.Decimal(18, 2)
  taxAmount            Decimal                  @default(0) @db.Decimal(18, 2)
  totalAmount          Decimal                  @default(0) @db.Decimal(18, 2)
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime                 @updatedAt
  paymentTerm          PaymentTermPurchaseOrder @default(COD)
  purchaseRequestId    String?
  requestRevisi        Int                      @default(0)
  sPKId                String?
  teamId               String?
  warehouseId          String
  sisaBudget           Decimal                  @default(0) @db.Decimal(19, 2)
  goodsReceipts        GoodsReceipt[]
  materialRequisitions MaterialRequisition[]
  PurchaseExecution    PurchaseExecution[]
  orderedBy            Karyawan                 @relation(fields: [orderedById], references: [id])
  project              Project?                 @relation(fields: [projectId], references: [id])
  PurchaseRequest      PurchaseRequest?         @relation(fields: [purchaseRequestId], references: [id])
  SPK                  SPK?                     @relation(fields: [sPKId], references: [id])
  supplier             Supplier                 @relation(fields: [supplierId], references: [id])
  team                 Team?                    @relation(fields: [teamId], references: [id])
  warehouse            Warehouse                @relation(fields: [warehouseId], references: [id])
  lines                PurchaseOrderLine[]
  supplierInvoices     SupplierInvoice[]
}

model PurchaseOrderLine {
  id                     String                 @id @default(uuid())
  description            String
  quantity               Decimal                @default(0) @db.Decimal(18, 4)
  unitPrice              Decimal                @default(0) @db.Decimal(18, 2)
  totalAmount            Decimal                @default(0) @db.Decimal(18, 2)
  poId                   String
  prDetailId             String?
  productId              String
  receivedQuantity       Decimal                @default(0) @db.Decimal(18, 4)
  checkMatch             Boolean                @default(false)
  checkPurchaseExecution Boolean                @default(false)
  purchasedQuantity      Decimal                @default(0) @db.Decimal(18, 4)
  qtyActual              Decimal                @default(0) @db.Decimal(18, 4)
  remainingQuantity      Decimal                @default(0) @db.Decimal(18, 4)
  unitPriceActual        Decimal                @default(0) @db.Decimal(18, 2)
  notGr                  Boolean                @default(false)
  grItems                GoodsReceiptItem[]
  purchaseOrder          PurchaseOrder          @relation(fields: [poId], references: [id], onDelete: Cascade)
  prDetail               PurchaseRequestDetail? @relation(fields: [prDetailId], references: [id])
  product                Product                @relation(fields: [productId], references: [id])
  receiptItems           ReceiptItem[]
}

model PurchaseExecution {
  id            String                  @id @default(uuid())
  poId          String
  executorId    String
  executionDate DateTime                @default(now())
  status        PurchaseExecutionStatus @default(IN_PROGRESS)
  totalSpent    Decimal                 @default(0) @db.Decimal(18, 2)
  notes         String?
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  executor      Karyawan                @relation(fields: [executorId], references: [id])
  purchaseOrder PurchaseOrder           @relation(fields: [poId], references: [id])
  receipts      PurchaseReceipt[]
}

model PurchaseReceipt {
  id            String            @id @default(uuid())
  receiptNumber String?
  storeName     String?
  receiptDate   DateTime
  totalAmount   Decimal           @db.Decimal(18, 2)
  paymentMethod PaymentMethod     @default(CASH)
  executionId   String
  ledgerId      String?
  createdAt     DateTime          @default(now())
  execution     PurchaseExecution @relation(fields: [executionId], references: [id], onDelete: Cascade)
  ledger        Ledger?           @relation(fields: [ledgerId], references: [id])
  items         ReceiptItem[]
  photos        ReceiptPhoto[]
}

model ReceiptPhoto {
  id            String           @id @default(uuid())
  receiptId     String
  receiptItemId String?
  photoUrl      String
  photoType     ReceiptPhotoType @default(BON)
  createdAt     DateTime         @default(now())
  receipt       PurchaseReceipt  @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  receiptItem   ReceiptItem?     @relation(fields: [receiptItemId], references: [id])
}

model ReceiptItem {
  id           String             @id @default(uuid())
  receiptId    String
  poLineId     String?
  isAdditional Boolean            @default(false)
  productName  String
  quantity     Decimal            @db.Decimal(18, 4)
  unit         String
  unitPrice    Decimal            @db.Decimal(18, 2)
  totalPrice   Decimal            @db.Decimal(18, 2)
  storeName    String?
  notes        String?
  createdAt    DateTime           @default(now())
  poLine       PurchaseOrderLine? @relation(fields: [poLineId], references: [id])
  receipt      PurchaseReceipt    @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  photos       ReceiptPhoto[]
}

model SupplierInvoice {
  id                 String                @id @default(uuid())
  invoiceNumber      String
  invoiceDate        DateTime
  dueDate            DateTime
  status             SupplierInvoiceStatus @default(DRAFT)
  supplierId         String
  purchaseOrderId    String?
  subtotal           Decimal               @db.Decimal(18, 2)
  taxAmount          Decimal               @default(0) @db.Decimal(18, 2)
  totalAmount        Decimal               @db.Decimal(18, 2)
  amountPaid         Decimal               @default(0) @db.Decimal(18, 2)
  journalEntryId     String?               @unique
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  notes              String?
  paymentAllocations PaymentAllocation[]
  journalEntry       JournalEntry?         @relation(fields: [journalEntryId], references: [id])
  purchaseOrder      PurchaseOrder?        @relation(fields: [purchaseOrderId], references: [id])
  supplier           Supplier              @relation(fields: [supplierId], references: [id])
  items              SupplierInvoiceItem[]

  @@unique([supplierId, invoiceNumber])
}

model SupplierInvoiceItem {
  id                  String          @id @default(uuid())
  supplierInvoiceId   String
  productId           String
  productName         String
  poLineId            String?
  goodsReceivedItemId String?
  quantity            Decimal         @db.Decimal(18, 4)
  unitPrice           Decimal         @db.Decimal(18, 2)
  totalPrice          Decimal         @db.Decimal(18, 2)
  priceVariance       Decimal         @default(0) @db.Decimal(18, 2)
  createdAt           DateTime        @default(now())
  product             Product         @relation(fields: [productId], references: [id])
  supplierInvoice     SupplierInvoice @relation(fields: [supplierInvoiceId], references: [id], onDelete: Cascade)
}

model SupplierPayment {
  id            String              @id @default(uuid())
  paymentNumber String              @unique
  paymentDate   DateTime            @default(now())
  amount        Decimal             @db.Decimal(18, 2)
  paymentMethod PaymentMethod
  bankAccountId String?
  notes         String?
  createdAt     DateTime            @default(now())
  allocations   PaymentAllocation[]
}

model PaymentAllocation {
  id                String          @id @default(uuid())
  paymentVoucherId  String
  supplierInvoiceId String
  amount            Decimal         @db.Decimal(18, 2)
  supplierPaymentId String
  paymentVoucher    PaymentVoucher  @relation(fields: [paymentVoucherId], references: [id])
  supplierInvoice   SupplierInvoice @relation(fields: [supplierInvoiceId], references: [id])
  supplierPayment   SupplierPayment @relation(fields: [supplierPaymentId], references: [id])

  @@unique([paymentVoucherId, supplierInvoiceId, supplierPaymentId])
}

model PaymentVoucher {
  id                String                @id @default(uuid())
  voucherNumber     String                @unique
  paymentDate       DateTime
  paymentMethod     SupplierPaymentMethod
  amount            Decimal               @db.Decimal(18, 2)
  notes             String?
  supplierId        String
  paidFromAccountId String
  journalEntryId    String?               @unique
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  Ledger            Ledger[]
  allocations       PaymentAllocation[]
  journalEntry      JournalEntry?         @relation(fields: [journalEntryId], references: [id])
  paidFromAccount   ChartOfAccounts       @relation(fields: [paidFromAccountId], references: [id])
  supplier          Supplier              @relation(fields: [supplierId], references: [id])
}

model StaffBalance {
  id         String         @id @default(uuid())
  karyawanId String
  category   LedgerCategory
  totalIn    Decimal        @default(0) @db.Decimal(15, 2)
  totalOut   Decimal        @default(0) @db.Decimal(15, 2)
  amount     Decimal        @default(0) @db.Decimal(15, 2)
  updatedAt  DateTime       @updatedAt
  karyawan   Karyawan       @relation(fields: [karyawanId], references: [id])

  @@unique([karyawanId, category])
}

model StaffLedger {
  id                String                     @id @default(uuid())
  karyawanId        String
  tanggal           DateTime                   @default(now())
  keterangan        String
  saldoAwal         Decimal                    @default(0) @db.Decimal(15, 2)
  debit             Decimal                    @default(0) @db.Decimal(15, 2)
  kredit            Decimal                    @default(0) @db.Decimal(15, 2)
  saldo             Decimal                    @db.Decimal(15, 2)
  category          LedgerCategory
  type              TransactionStafBalanceType
  purchaseRequestId String?
  refId             String?
  createdBy         String?
  createdAt         DateTime                   @default(now())
  updatedAt         DateTime                   @default(now()) @updatedAt
  karyawan          Karyawan                   @relation(fields: [karyawanId], references: [id])
  purchaseRequest   PurchaseRequest?           @relation(fields: [purchaseRequestId], references: [id])
}

model Ledger {
  id               String            @id @default(uuid())
  ledgerNumber     String            @unique
  referenceNumber  String?
  referenceType    LedgerEntryType
  transactionDate  DateTime
  postingDate      DateTime
  description      String
  notes            String?
  periodId         String
  status           LedgerStatus      @default(DRAFT)
  currency         String            @default("IDR")
  exchangeRate     Float             @default(1.0)
  createdBy        String
  postedBy         String?
  postedAt         DateTime?
  voidBy           String?
  voidAt           DateTime?
  voidReason       String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  journalEntryId   String?
  paymentVoucherId String?
  fundTransfer     FundTransfer?
  journalEntry     JournalEntry?     @relation(fields: [journalEntryId], references: [id])
  paymentVoucher   PaymentVoucher?   @relation(fields: [paymentVoucherId], references: [id])
  period           AccountingPeriod  @relation(fields: [periodId], references: [id])
  ledgerLines      LedgerLine[]
  receipts         PurchaseReceipt[]

  @@index([transactionDate])
  @@index([postingDate])
  @@index([periodId])
  @@index([status])
}

model LedgerLine {
  id                   String               @id @default(uuid())
  ledgerId             String
  coaId                String
  debitAmount          Float                @default(0)
  creditAmount         Float                @default(0)
  currency             String               @default("IDR")
  localAmount          Float
  foreignCurrency      String?
  foreignAmount        Float?
  exchangeRate         Float                @default(1.0)
  projectId            String?
  customerId           String?
  supplierId           String?
  karyawanId           String?
  description          String?
  reference            String?
  lineNumber           Int
  reconciliationStatus ReconciliationStatus @default(UNRECONCILED)
  reconciledDate       DateTime?
  reconciledBy         String?
  bankStatementRef     String?
  taxAmount            Float                @default(0)
  taxRateId            String?
  taxInclusive         Boolean              @default(false)
  isAllocated          Boolean              @default(false)
  allocationId         String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  salesOrderId         String?
  coa                  ChartOfAccounts      @relation(fields: [coaId], references: [id])
  customer             Customer?            @relation(fields: [customerId], references: [id])
  karyawan             Karyawan?            @relation(fields: [karyawanId], references: [id])
  ledger               Ledger               @relation(fields: [ledgerId], references: [id], onDelete: Cascade)
  project              Project?             @relation(fields: [projectId], references: [id])
  salesOrder           SalesOrder?          @relation(fields: [salesOrderId], references: [id])
  supplier             Supplier?            @relation(fields: [supplierId], references: [id])
  taxRate              TaxRate?             @relation(fields: [taxRateId], references: [id])
  ReconciliationItem   ReconciliationItem[]

  @@unique([ledgerId, lineNumber])
  @@index([ledgerId])
  @@index([coaId])
  @@index([reconciliationStatus])
  @@index([projectId])
  @@index([customerId])
  @@index([supplierId])
}

model AccountingPeriod {
  id                   String                 @id @default(uuid())
  periodCode           String                 @unique
  periodName           String
  startDate            DateTime
  endDate              DateTime
  fiscalYear           Int
  quarter              Int
  isClosed             Boolean                @default(false)
  closedAt             DateTime?
  closedBy             String?
  reopenAt             DateTime?
  reopenBy             String?
  reopenReason         String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  financialReports     FinancialReport[]
  fundTransfers        FundTransfer[]
  GeneralLedgerSummary GeneralLedgerSummary[]
  ledgers              Ledger[]
  Reconciliation       Reconciliation[]
  TrialBalance         TrialBalance[]

  @@index([fiscalYear])
  @@index([startDate, endDate])
}

model TrialBalance {
  id            String           @id @default(uuid())
  periodId      String
  coaId         String
  openingDebit  Float            @default(0)
  openingCredit Float            @default(0)
  periodDebit   Float            @default(0)
  periodCredit  Float            @default(0)
  endingDebit   Float            @default(0)
  endingCredit  Float            @default(0)
  ytdDebit      Float            @default(0)
  ytdCredit     Float            @default(0)
  currency      String           @default("IDR")
  calculatedAt  DateTime
  coa           ChartOfAccounts  @relation(fields: [coaId], references: [id])
  period        AccountingPeriod @relation(fields: [periodId], references: [id])

  @@unique([periodId, coaId])
  @@index([periodId])
  @@index([coaId])
}

model GeneralLedgerSummary {
  id               String           @id @default(uuid())
  coaId            String
  periodId         String
  date             DateTime
  openingBalance   Float            @default(0)
  debitTotal       Float            @default(0)
  creditTotal      Float            @default(0)
  closingBalance   Float            @default(0)
  transactionCount Int              @default(0)
  currency         String           @default("IDR")
  coa              ChartOfAccounts  @relation(fields: [coaId], references: [id])
  period           AccountingPeriod @relation(fields: [periodId], references: [id])

  @@unique([coaId, periodId, date])
  @@index([coaId, date])
}

model Reconciliation {
  id                   String               @id @default(uuid())
  reconciliationNumber String               @unique
  coaId                String
  periodId             String
  startDate            DateTime
  endDate              DateTime
  bookBalance          Float
  bookCurrency         String               @default("IDR")
  statementBalance     Float
  statementDate        DateTime
  statementRef         String
  reconciledBalance    Float
  difference           Float
  status               ReconciliationStatus @default(PENDING)
  description          String?
  notes                String?
  preparedBy           String
  preparedAt           DateTime
  reviewedBy           String?
  reviewedAt           DateTime?
  approvedBy           String?
  approvedAt           DateTime?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  coa                  ChartOfAccounts      @relation(fields: [coaId], references: [id])
  period               AccountingPeriod     @relation(fields: [periodId], references: [id])
  reconciliationItems  ReconciliationItem[]

  @@index([coaId])
  @@index([periodId])
  @@index([status])
}

model ReconciliationItem {
  id                String         @id @default(uuid())
  reconciliationId  String
  ledgerLineId      String
  transactionAmount Float
  transactionDate   DateTime
  statementAmount   Float?
  statementDate     DateTime?
  isCleared         Boolean        @default(false)
  clearedDate       DateTime?
  description       String?
  notes             String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  ledgerLine        LedgerLine     @relation(fields: [ledgerLineId], references: [id])
  reconciliation    Reconciliation @relation(fields: [reconciliationId], references: [id], onDelete: Cascade)

  @@unique([reconciliationId, ledgerLineId])
  @@index([reconciliationId])
  @@index([ledgerLineId])
}

model FinancialReport {
  id                  String                   @id @default(uuid())
  reportNumber        String                   @unique
  reportTypeFinancial ReportTypeFinancial
  periodId            String
  title               String
  generatedAt         DateTime
  generatedBy         String
  currency            String                   @default("IDR")
  filePath            String?
  fileFormat          String?
  templateId          String?
  parameters          Json?
  createdAt           DateTime                 @default(now())
  updatedAt           DateTime                 @updatedAt
  period              AccountingPeriod         @relation(fields: [periodId], references: [id])
  reportSections      FinancialReportSection[]

  @@index([periodId])
  @@index([reportTypeFinancial])
}

model FinancialReportSection {
  id              String                   @id @default(uuid())
  reportId        String
  sectionCode     String
  sectionName     String
  sequence        Int
  level           Int                      @default(0)
  amount          Float                    @default(0)
  calculationType CalculationType
  formula         String?
  parentId        String?
  parent          FinancialReportSection?  @relation("ReportSectionHierarchy", fields: [parentId], references: [id])
  children        FinancialReportSection[] @relation("ReportSectionHierarchy")
  report          FinancialReport          @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@index([reportId])
  @@index([sectionCode])
}

model SystemAccount {
  id          String          @id @default(uuid())
  key         String          @unique
  description String?
  coaId       String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  coa         ChartOfAccounts @relation(fields: [coaId], references: [id])
}

model OpeningBalance {
  id          String                 @id @default(uuid())
  asOfDate    DateTime
  description String
  isPosted    Boolean                @default(false)
  postedAt    DateTime?
  createdAt   DateTime               @default(now())
  details     OpeningBalanceDetail[]
}

model OpeningBalanceDetail {
  id               String          @id @default(uuid())
  openingBalanceId String
  accountId        String
  debit            Decimal         @default(0)
  credit           Decimal         @default(0)
  account          ChartOfAccounts @relation(fields: [accountId], references: [id])
  openingBalance   OpeningBalance  @relation(fields: [openingBalanceId], references: [id])
}

model FundTransfer {
  id            String             @id @default(uuid())
  transferNo    String             @unique
  transferDate  DateTime           @default(now())
  amount        Decimal            @db.Decimal(20, 2)
  feeAmount     Decimal            @default(0) @db.Decimal(20, 2)
  totalAmount   Decimal            @db.Decimal(20, 2)
  fromAccountId String
  toAccountId   String
  feeAccountId  String?
  referenceNo   String?
  notes         String?
  status        FundTransferStatus @default(POSTED)
  ledgerId      String?            @unique
  periodId      String?
  createdById   String
  approvedById  String?
  approvedAt    DateTime?
  voidedById    String?
  voidedAt      DateTime?
  voidReason    String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  approvedBy    User?              @relation("FundTransferApprover", fields: [approvedById], references: [id])
  createdBy     User               @relation("FundTransferCreator", fields: [createdById], references: [id])
  feeAccount    ChartOfAccounts?   @relation("FundTransferFee", fields: [feeAccountId], references: [id])
  fromAccount   ChartOfAccounts    @relation("FundTransferSource", fields: [fromAccountId], references: [id])
  ledger        Ledger?            @relation(fields: [ledgerId], references: [id])
  period        AccountingPeriod?  @relation(fields: [periodId], references: [id])
  toAccount     ChartOfAccounts    @relation("FundTransferDestination", fields: [toAccountId], references: [id])
  voidedBy      User?              @relation("FundTransferVoider", fields: [voidedById], references: [id])

  @@index([transferDate])
  @@index([status])
  @@index([fromAccountId])
  @@index([toAccountId])
  @@index([createdById])
}

enum AuthProvider {
  credentials
  google
}

enum UserRole {
  super
  admin
  pic
  user
}

enum OpnameType {
  INITIAL
  PERIODIC
  AD_HOC
}

enum OpnameStatus {
  DRAFT
  ADJUSTED
  CANCELLED
  COMPLETED
}

enum TransferStatus {
  DRAFT
  PENDING
  IN_TRANSIT
  RECEIVED
  CANCELLED
}

enum TransactionType {
  IN
  OUT
  ADJUSTMENT_IN
  ADJUSTMENT_OUT
}

enum SourceType {
  PO
  DIRECT
  PROJECT
  RETURN
  OPNAME
  WASTAGE
  TRANSFER
}

enum QCStatus {
  PENDING
  ARRIVED
  PASSED
  REJECTED
  PARTIAL
}

enum ItemStatus {
  RECEIVED
  PARTIAL
  REJECTED
}

enum DocumentStatus {
  DRAFT
  COMPLETED
  CANCELLED
  ARRIVED
  PASSED
}

enum MRStatus {
  PENDING
  APPROVED
  ISSUED
  CANCELLED
  READY_TO_PICKUP
}

enum CategoryRAB {
  PRELIMINARY
  SITEPREP
  STRUCTURE
  ARCHITECTURE
  MEP
  FINISHING
  LANDSCAPE
  EQUIPMENT
  OVERHEAD
  OTHER
}

enum CostType {
  MATERIAL
  LABOR
  OTHER
  EQUIPMENT
  SUBCON
  TRANSPORT
  OVERHEAD
}

enum RABStatus {
  DRAFT
  APPROVED
  REJECTED
}

enum ProductType {
  Material
  Jasa
  Alat
  FinishedGoods
  SparePart
  Consumable
  Asset
  Rental
  Software
  Packaging
  MRO
  Scrap
  Refurbished
  Return
}

enum QuotationStatus {
  DRAFT
  SENT
  REVIEW
  APPROVED
  REJECTED
  EXPIRED
  CANCELLED
}

enum LineType {
  PRODUCT
  SERVICE
  FREIGHT
  OTHER
}

enum DiscountType {
  PERCENT
  AMOUNT
}

enum OrderType {
  REGULAR
  SUPPORT
}

enum OrderStatus {
  DRAFT
  CONFIRMED
  IN_PROGRESS_SPK
  FULFILLED
  BAST
  PARTIALLY_INVOICED
  INVOICED
  PARTIALLY_PAID
  PAID
  CANCELLED
}

enum ItemType {
  PRODUCT
  SERVICE
  CUSTOM
}

enum DocType {
  QUOTATION
  PO
  BAP
  INVOICE
  PAYMENT_RECEIPT
  SPK
}

enum ReportType {
  PROGRESS
  FINAL
}

enum ReportStatus {
  PENDING
  APPROVED
  REJECTED
}

enum PhotoCategory {
  BEFORE
  PROCESS
  AFTER
}

enum BAPStatus {
  DRAFT
  IN_PROGRESS
  COMPLETED
  APPROVED
}

enum InvoiceStatus {
  DRAFT
  WAITING_APPROVAL
  APPROVED
  REJECTED
  UNPAID
  PARTIALLY_PAID
  PAID
  OVERDUE
  CANCELLED
  POSTED
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  VOID
  POSTED
}

enum PaymentMethod {
  TRANSFER
  CASH
  CREDIT_CARD
  VA
  E_WALLET
  CHEQUE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum InstallmentStatus {
  PENDING
  DUE_SOON
  OVERDUE
  PARTIALLY_PAID
  PAID
}

enum ExpenseStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  REJECTED
  PAID
  CANCELLED
}

enum BudgetStatus {
  DRAFT
  PROPOSED
  APPROVED
  ACTIVE
  CLOSED
  CANCELLED
}

enum PurchaseRequestStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  COMPLETED
  REVISION_NEEDED
}

enum SourceProductType {
  PEMBELIAN_BARANG
  PENGAMBILAN_STOK
  OPERATIONAL
  JASA_PEMBELIAN
  JASA_INTERNAL
}

enum UangMukaStatus {
  PENDING
  DISBURSED
  SETTLED
  REJECTED
}

enum MetodePembayaran {
  CASH
  BANK_TRANSFER
  E_WALLET
}

enum StatusRincianPj {
  PENDING
  APPROVED
  REJECTED
  REVISION
}

enum JenisPembayaran {
  CASH
  TRANSFER
  DEBIT
  CREDIT_CARD
  QRIS
}

enum CoaType {
  ASET
  LIABILITAS
  EKUITAS
  PENDAPATAN
  HPP
  BEBAN
}

enum CoaNormalBalance {
  DEBIT
  CREDIT
}

enum CoaPostingType {
  HEADER
  POSTING
}

enum CoaCashflowType {
  OPERATING
  INVESTING
  FINANCING
  NONE
}

enum CoaStatus {
  ACTIVE
  INACTIVE
  LOCKED
}

enum SupplierStatus {
  ACTIVE
  INACTIVE
  BLACKLISTED
}

enum PurchaseOrderStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  REJECTED
  SENT
  PARTIALLY_RECEIVED
  FULLY_RECEIVED
  CANCELLED
  REVISION_NEEDED
  REQUEST_REVISION
  INVOICE_RECEIVED
  UNVERIFIED_ACCOUNTING
  VERIFIED_ACCOUNTING
  APPROVED_ACCOUNTING
  POSTED
  AWAITING_PAYMENT
  PARTIALLY_PAID
  FULLY_PAID
}

enum SupplierInvoiceStatus {
  DRAFT
  PENDING_APPROVAL
  AWAITING_PAYMENT
  PARTIALLY_PAID
  FULLY_PAID
  OVERDUE
  CANCELLED
  REVISION_NEEDED
  UNVERIFIED
  VERIFIED
  APPROVED
  POSTED
  VOIDED
  DISPUTED
  WRITTEN_OFF
}

enum SupplierPaymentMethod {
  BANK_TRANSFER
  CASH
  CHEQUE
  VIRTUAL_ACCOUNT
}

enum PaymentTermPurchaseOrder {
  CASH
  COD
  NET_7
  NET_14
  NET_30
  DP_PERCENTAGE
}

enum PurchaseExecutionStatus {
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ReceiptPhotoType {
  BON
  PRODUCT
  OTHER
}

enum LedgerCategory {
  OPERASIONAL_PROYEK
  PINJAMAN_PRIBADI
}

enum TransactionStafBalanceType {
  OPENING_BALANCE
  CASH_ADVANCE
  EXPENSE_REPORT
  LOAN_DISBURSEMENT
  LOAN_REPAYMENT
  REIMBURSEMENT
  SETTLEMENT_REFUND
}

enum LedgerEntryType {
  JOURNAL
  PAYMENT
  RECEIPT
  ADJUSTMENT
  CLOSING
  REVERSAL
  GOODS_RECEIPT
  ASSET_MAINTENANCE
  ASSET_DEPRECIATION
}

enum LedgerStatus {
  DRAFT
  POSTED
  VOID
  LOCKED
  RECONCILED
  PARTIAL_RECONCILED
}

enum ReconciliationStatus {
  UNRECONCILED
  PENDING
  RECONCILED
  DISPUTED
}

enum ReportTypeFinancial {
  BALANCE_SHEET
  INCOME_STATEMENT
  CASHFLOW_STATEMENT
  TRIAL_BALANCE
  GENERAL_LEDGER
  PROFIT_LOSS
  RETAINED_EARNINGS
  BUDGET_VS_ACTUAL
  AGING_REPORT
}

enum CalculationType {
  HEADER
  SUM
  AVERAGE
  FORMULA
  PERCENTAGE
}

enum FundTransferStatus {
  DRAFT
  POSTED
  VOIDED
}

model AssetCategory {
  id                     String             @id @default(uuid())
  name                   String             @unique
  description            String?
  usefulLife             Int // in years
  depreciationMethod     DepreciationMethod @default(STRAIGHT_LINE)
  assetAccountId         String
  accumDeprecAccountId   String
  deprecExpenseAccountId String
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt

  assetAccount         ChartOfAccounts @relation("AssetAccount", fields: [assetAccountId], references: [id])
  accumDeprecAccount   ChartOfAccounts @relation("AccumDeprecAccount", fields: [accumDeprecAccountId], references: [id])
  deprecExpenseAccount ChartOfAccounts @relation("DeprecExpenseAccount", fields: [deprecExpenseAccountId], references: [id])
  assets               FixedAsset[]
}

model FixedAsset {
  id                   String      @id @default(uuid())
  assetCode            String      @unique
  name                 String
  description          String?
  categoryId           String
  acquisitionDate      DateTime
  acquisitionCost      Decimal     @db.Decimal(19, 2)
  salvageValue         Decimal     @default(0) @db.Decimal(19, 2)
  usefulLife           Int // in years (overrides category if set)
  location             String?
  department           String?
  status               AssetStatus @default(ACTIVE)
  lastDepreciationDate DateTime?
  totalDepreciation    Decimal     @default(0) @db.Decimal(19, 2)
  bookValue            Decimal     @db.Decimal(19, 2)
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt

  category      AssetCategory       @relation(fields: [categoryId], references: [id])
  depreciations AssetDepreciation[]
  maintenances  AssetMaintenance[]
}

model AssetMaintenance {
  id              String    @id @default(uuid())
  assetId         String
  maintenanceDate DateTime
  type            String // 'ROUTINE', 'REPAIR', 'UPGRADE'
  description     String
  cost            Decimal   @db.Decimal(19, 2)
  performedBy     String?
  supplierId      String?
  nextSchedule    DateTime?
  status          String    @default("COMPLETED") // 'SCHEDULED', 'IN_PROGRESS', 'COMPLETED'
  ledgerId        String?   @unique
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  asset    FixedAsset @relation(fields: [assetId], references: [id], onDelete: Cascade)
  supplier Supplier?  @relation(fields: [supplierId], references: [id])
}

model AssetDepreciation {
  id               String   @id @default(uuid())
  assetId          String
  depreciationDate DateTime
  amount           Decimal  @db.Decimal(19, 2)
  periodId         String
  ledgerId         String?  @unique
  createdAt        DateTime @default(now())

  asset FixedAsset @relation(fields: [assetId], references: [id], onDelete: Cascade)
}

enum DepreciationMethod {
  STRAIGHT_LINE
  DOUBLE_DECLINING
  NONE
}

enum AssetStatus {
  ACTIVE
  DISPOSED
  SOLD
  WRITTEN_OFF
}
